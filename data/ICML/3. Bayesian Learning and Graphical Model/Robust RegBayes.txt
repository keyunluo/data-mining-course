Robust RegBayes: Selectively Incorporating
First-Order Logic Domain Knowledge into Bayesian Models

Shike Mei‚Ä†
MEI @ CS . WISC . EDU
Jun Zhu¬ß
DCSZJ @ MAIL . TSINGHUA . EDU . CN
Xiaojin Zhu‚Ä†
JERRYZHU @ CS . WISC . EDU
‚Ä†
Department of Computer Sciences, University of Wisconsin-Madison, Madison, WI, USA 53706
¬ß
Dept. of Comp. Sci. & Tech., TNList Lab, State Key Lab of Intell. Tech. & Sys., Tsinghua University, China

Abstract
Much research in Bayesian modeling has been
done to elicit a prior distribution that incorporates domain knowledge. We present a novel and
more direct approach by imposing First-Order
Logic (FOL) rules on the posterior distribution.
Our approach unifies FOL and Bayesian modeling under the regularized Bayesian framework.
In addition, our approach automatically estimates
the uncertainty of FOL rules when they are produced by humans, so that reliable rules are incorporated while unreliable ones are ignored. We
apply our approach to latent topic modeling tasks
and demonstrate that by combining FOL knowledge and Bayesian modeling, we both improve
the task performance and discover more structured latent representations in unsupervised and
supervised learning.

1. Introduction
Incorporating domain knowledge into the learning process
is an effective way to improve the accuracy of predictive
tasks (Richardson & Domingos, 2006) or the interpretability of latent representations (Andrzejewski et al., 2011).
Bayesian methods provide a rigorous mathematical framework to incorporate domain knowledge via Bayes‚Äô rule.
Much research has been done on eliciting an informative
prior, either directly (Garthwaite et al., 2005) or indirectly
by imposing parameter constraints and confidence values (Mao & Lebanon, 2009). Furthermore, Bayesian methods naturally handle noise in domain knowledge, which is
especially important when domain knowledge is collected
from the crowd, e.g. (Raykar et al., 2010).
Proceedings of the 31 st International Conference on Machine
Learning, Beijing, China, 2014. JMLR: W&CP volume 32. Copyright 2014 by the author(s).

However, since the ultimate goal of Bayesian methods is
to infer a posterior distribution, it is arguably more direct to impose domain knowledge directly on the posterior
distribution. The regularized Bayesian framework (RegBayes) does this via posterior constraints (or equivalent
posterior regularization) using a variational representation
of Bayes‚Äô rule (Zhu et al., 2013b). RegBayes has had significant success in learning discriminative Bayesian models by conjoining max-margin learning and Bayesian nonparametrics (Zhu et al., 2011; Zhu, 2012). Nonetheless,
the domain knowledge considered in RegBayes so far has
been max-margin posterior constraints, which could be too
narrow and inapplicable to unsupervised learning. Furthermore, no existing RegBayes model has explicitly modeled
the noise in domain knowledge.
In this paper we introduce Robust RegBayes, a principled framework to robustly incorporate rich and uncertain
domain knowledge in both unsupervised and supervised
learning tasks. Our contributions are two-fold: First, we
greatly extend the scope of RegBayes domain knowledge
by allowing First-Order Logic (FOL) rules. To achieve this,
we use groundings of the FOL formulas and define features
as expected number of groundings in which the formula is
true. In producing FOL domain knowledge, domain experts are often able to focus on high-level modeling goals
of the application domain. Second, we explicitly model the
uncertainty in domain knowledge using a spike-and-slab
prior. This allows us to automatically and selectively incorporate high-quality domain knowledge while ignoring lowquality ones. Our experiments on Robust RegBayes, especially on various latent Dirichlet allocation (LDA) (Blei
et al., 2003) tasks, convincingly demonstrate improved task
performance and topic interpretability in both unsupervised
and supervised settings. Compared to First-Order Logic
LDA (Fold¬∑all, a state-of-the-art framework to incorporate
FOL rules into LDA) (Andrzejewski et al., 2011) which requires experts to manually set the weights of FOL rules,
Robust RegBayes automatically learns the weights. Com-

Distributions

ùêª

ùëèùëô

ùõæùëô

4

Density

6

spike
slab

2

pared to max-margin supervised LDA that incorporates
word features (Zhu & Xing, 2010), it discovers more interpretable topics without sacrificing prediction accuracy.

8

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models

ùëã

0

2. The Robust RegBayes Framework

0.0

2.1. RegBayes with FOL Domain Knowledge
We first review the RegBayes framework (Zhu et al.,
2013b). Consider a generic Bayesian latent variable model
with observed random variables X ‚àà X and hidden variables H ‚àà H. Standard Bayesian inference calculates the
posterior distribution p(H | X) from a prior p0 (H) and
a likelihood model. It is often difficult to make sure that
the posterior satisfies all domain knowledge constraints. In
contrast, the RegBayes framework allows domain knowledge to directly influence the posterior. RegBayes does so
by penalizing distributions that differ in the expected value
of feature functions. Each feature function, denoted as œÜl ,
and the ‚Äúbelief label‚Äù of the feature, denoted as Œ≥l , are induced from domain knowledge. Formally, the RegBayes
inference procedure is defined as a constrained optimization problem:
X
min
KL (q(H) k p(H | X)) + C
Œæl (1)
q(H)‚ààP,Œæ‚ààRL
+

l


s.t. Eq(H) [œÜl (H, X)] ‚àí Œ≥l  ‚â§  + Œæl ,

where P denotes the appropriate probability simplex;
p(H | X) is the posterior distribution via Bayes‚Äô rule;
Œæ ‚àà RL
+ is the vector of L slack variables, one for each
domain knowledge constraint;  is a small positive precision parameter; and C is a regularization parameter. The
key difference between RegBayes and standard Bayesian
model is that the ‚Äúoptimal distribution‚Äù q(H) obtained by
solving Eq (1) can be different from p(H | X). The standard Bayesian posterior is a special case of RegBayes, as
can be seen by setting C = 0.
Despite its success, the application of RegBayes so far has
been limited to max-margin constraints (Zhu et al., 2011).
Max-margin constraints cannot represent many kinds of
rich domain knowledge such as those for unsupervised
models. To substantially broaden the scope of knowledge
used in RegBayes, we consider FOL rules in this paper.
FOL is a particularly flexible and powerful knowledge representation. It has the additional benefit of insulating the
domain experts from the intricacy of Bayesian inference.
Formally, let Rl be the lth FOL rule represented in Conjunctive Normal Form with logical predicates over instantiations (h, x) of the variables (H, X). To tie the rule
to RegBayes, we define a feature function œÜl to provide
finer resolution over the domain knowledge. Specifically,
let Gl be the set of groundings
of Rl , we define the feaP
ture function œÜl = |G1l | gl ‚ààGl 1(gl (h, x)). Note that this

0.2

0.4

0.6

0.8

ùõæùëôùëö
ùëÄ ùêø

1.0

Label

(a)

(b)

Figure 1. (a) An example of the spike-slab likelihood p(Œ≥ÃÉlm |
Œ≥l , bl ), where the slab component is a uniform distribution on
[0, 1] (blue line) and the spike component is a truncated Gaussian with a small variance (red line). (b) The Robust RegBayes
model.

feature function takes value in [0, 1] (rather than {0, 1})
and captures the fraction of groundings where the rule is
true. We let the ‚Äúgolden standard‚Äù expectation of rule Rl
be Œ≥l = E [œÜl (H, X)] under the desired distribution. Soliciting Œ≥l from domain experts is difficult and will be addressed in the next section.
Compared to Markov Logic Network (MLN) which has the
goal of modeling FOL rules in probabilistic terms, RegBayes FOL rules are meant to influence a separate Bayesian
model. Therefore, RegBayes truly combines FOL and
Bayesian modeling. Compared to some other prior work
on incorporating FOL into probabilistic models such as
Fold.all (Andrzejewski et al., 2011), one major advantage of RegBayes is to automatically learn the FOL rule
weights. These weights would be hard (if not impossible)
for humans to manually set, especially in a crowd setting.
RegBayes learns the rule weights from relatively easier-toobtain belief labels via solving a dual optimization problem, as we show next.
2.2. Robust RegBayes
The golden standard Œ≥l for each rule is rarely observed
precisely in reality. We solve the problem by treating
expert-supplied values of Œ≥l as noisy observations. Formally, let the FOL knowledge base collected from experts
be KB = {Rl , Œ≥ÃÉ l }L
l=1 . The KB consists of L FOL rules.
Each rule Rl is associated with a set of noisy observations
Œ≥ÃÉ l = {Œ≥ÃÉlm : Œ≥ÃÉlm ‚àà [0, 1]}M
m=1 from M different human
experts, e.g., workers in a crowdsourcing setting. We interpret Œ≥ÃÉ as a degree of belief that the rule holds true over the
variables. Our KB is ‚Äúsoft,‚Äù similar to that in Fold¬∑all (Andrzejewski et al., 2011).
Given the noisy knowledge base KB, we are interested
in modeling the reliability of the rules. Previous studies on learning from crowds (Raykar et al., 2010; Welinder et al., 2010) made various assumptions on the experts
and tasks. In this paper, for robustness we restrict ourselves to two levels of rule reliability: If Œ≥ÃÉlm is labeled
coherently by multiple experts and the belief is corroborated by the Bayesian latent variable model, we hypothe-

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models

size that it is reliable and should be incorporated into our
Bayesian models; otherwise, we deem the rule unreliable
and ignore it. This knowledge selection process can be formally characterized by introducing a binary selecting variable bl ‚àà {0, 1} for each rule. We define a ‚Äúnoisy belief
likelihood‚Äù p(Œ≥ÃÉlm | Œ≥l , bl ) as a spike-slab mixture of two
components, selected by bl : If bl = 0, we use a slab distribution to generate diverse beliefs; If bl = 1, we use a spike
distribution to generate coherent labels. See Figure 1(a).
Our Robust RegBayes framework is defined as:
min KL (q(H, Œ≥, b) k p(H, Œ≥, b | X, Œ≥ÃÉ)) + C
q,Œæ

X

Œæl

l

(2)

where p(H, Œ≥, b | X, Œ≥ÃÉ) ‚àù p0 (H)p0 (b, Œ≥)p(X | H)p(Œ≥ÃÉ |
Œ≥, b) is the posterior distribution via Bayes‚Äô rule. Figure 1(b) shows the graphical model for Robust RegBayes.
The prior distribution p0 (b, Œ≥) for bl and Œ≥l will be discussed in the section of application to LDA. We make two
observations. First, if we collapse the model by reducing
the uncertainty on (Œ≥, b) and holding them constant (i.e.,
bl = 1 and Œ≥ÃÉ l = Œ≥l ), Eq (2) reduces to RegBayes Eq (1).
In general, Robust RegBayes (2) takes the uncertainty of
domain knowledge into consideration and the binary selecting variable bl specifies the importance of each logic
constraint. For unreliable domain knowledge, the corresponding bl will have a small probability of being 1 and
thus the expectation Eq(bl ) [bl ] (i.e., the importance of the
logic) will be small. Second, the reliability of rules (b, Œ≥)
and the underline Bayesian model (H, X) influence each
other in the Robust RegBayes framework. This is represented with the dashed arrow in Figure 1(b). We will see
the influence more clearly later in the applications on LDA.
2.3. A Generic Inference Procedure
Since the KL divergence is convex with respect to q (Wainwright & Jordan, 2008) and the posterior constraints are
intrinsically linear, problem (2) is convex. Thus, we can
apply convex analysis tools to derive a generic solution.
Specifically, by introducing a set of dual variables ¬µ we
obtain the optimal distribution:
q(H, Œ≥, b | ¬µ‚àó ) =

p(H, Œ≥, b | X, Œ≥ÃÉ) Pl ¬µ‚àól bl (œÜl (H,X)‚àíŒ≥l )
e
Z(¬µ‚àó )

where ¬µ‚àó is the optimum solution of the dual problem:
X
max L(¬µ) = ‚àí log Z(¬µ) ‚àí 
¬µl
(3)
¬µ

Despite its elegance, it is important to realize that the
generic inference procedure is in general intractable in latent variable models. One needs to utilize variational approximation or sampling techniques to find approximate
solutions. In the next section, we present a specific instantiation of Robust RegBayes to LDA models and detail one
way to perform efficient variational inference.

3. Application to LDA Models


 
s.t. Eq(bl ) bl Eq(H|bl ) [œÜl (H, X)] ‚àí Eq(Œ≥l |bl ) [Œ≥l ]
‚â§  + Œæl , Œæl ‚â• 0, ‚àÄl = 1 . . . L

H or not. By solving the dual problem (3), we automatically learn the optimal weights ¬µ‚àó . Then, by inferring bl
we selectively incorporate reliable FOL rules while ignoring unreliable ones.

3.1. Robust RegBayes Applied to LDA
We now give an instantiation of Robust RegBayes in learning LDA topics by incorporating FOL domain knowledge.
LDA posits that each document is drawn from an admixture of K topics. Each topic œïk is defined as a multinomial
distribution over a given vocabulary and follows a Dirichlet prior p(œïk | Œ≤) = Dir(œïk | Œ≤). For document d,
we draw a topic proportion Œ∏ d from a Dirichlet distribution
p(Œ∏ d | Œ±) = Dir(Œ∏ d | Œ±). For the ith word in document
d, we draw a topic assignment zdi from the multinomial
parametrized by Œ∏ d , p(zdi = k | Œ∏ d ) = Œ∏dk , and then
draw the word wdi from the selected topic œïzdi , that is
p(wdi | zdi , œï) = œïzdi ,wdi . The
 Q of LDA
Q joint distribution
is p(W, Z, œï, Œ∏ | Œ±, Œ≤) =
p(œï
|
Œ≤)
k
k
d p(Œ∏ d |
Q
Œ±) i p(zdi | Œ∏ d )p(wdi | zdi , œï) where W = {wdi } are
the observed words, Z = {zdi }, Œ∏ = {Œ∏dk }, œï = {œïdk }
are the hidden variables. In Bayesian methods, we aim
to infer the posterior over hidden variables p(Z, œï, Œ∏ |
W, Œ±, Œ≤).
For domain knowledge, we assume that all the FOL rules
are defined over the instantiation of words W and hidden
topic assignments Z. To account for uncertainty in knowledge, we model the belief labels Œ≥ÃÉlm by a spike-slab likelihood (cf. Figure 1(a)), where we define the slab component as uniform[0, 1] and the spike component as a truncated Gaussian distribution in [0, 1] with the golden standard Œ≥l as the mean and variance œÉl2 . The variance œÉl2 is
determined by empirical Bayes.
Q The likelihood is then defined as p(Œ≥ÃÉ l | Œ≥l , bl ) = m N (Œ≥ÃÉlm ; Œ≥l , œÉl2 )bl . We set
non-informative uniform priors for both bl and Œ≥l .
With the above definitions, we have H = {Z, Œ∏, œï} and
X = W. Plugging these variables to problem (2), we get
the optimization problem of learning robust logic LDA:

l

s.t. ‚àíC ‚â§ ¬µl ‚â§ C,
and Z(¬µ) is the normalization factor for q. Note that ¬µl is
the weight of logic rule l and the binary variable bl determines whether the rule affects the posterior distribution of

min KL (q(H, Œ≥, b) k p(H, Œ≥, b | W, Œ≥ÃÉ, Œ±, Œ≤)) + C
q,Œæ

X
l


 
s.t. Eq(bl ) bl Eq(Z|bl ) [œÜl (Z, W)] ‚àí Eq(Œ≥l |bl ) [Œ≥l ]
‚â§  + Œæl , Œæl ‚â• 0, ‚àÄl = 1 . . . L.

Œæl

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models

‚àö
Œªl = S M log( 2œÄœÉl ) +

3.2. Variational Approximation



To collapse the parameter space and improve inference accuracy, we first marginalize out the variables œï and Œ∏ by
exploring the conjugacy between multinomial and Dirichlet in a way similar to (Teh et al., 2007). This marginalization does not affect our logic constraints since they are
not directly defined on œï or Œ∏. In theory, we can apply
convex analysis tools to derive a closed-form expression of
the posterior distribution q as in Section 2.3 and solve the
dual problem of the generic form (3) for the dual parameters. Unfortunately, in practice it is intractable from the
posterior of logic LDA. Thus we resort to variational approximate methods, as detailed below.
Approximate Inference: Given the dual variables ¬µ, we
need to compute the collapsed posterior q(Z, Œ≥, b | ¬µ).
This can be done with variational methods. Specifically,
we
Q make
Q the mean field
Q assumption that qÃÉ(Z, Œ≥, b | ¬µ) =
d
i qÃÉ(zdi | œà di )
l qÃÉ(Œ≥l | œÅl )qÃÉ(bl | Œªl ), where qÃÉ(zdi |
œà di ) is a discrete distribution with parameters œà di ; qÃÉ(Œ≥l |
œÅl ) is a point-mass function centered on œÅl ; and qÃÉ(bl | Œªl )
is a Bernoulli distribution. Then, the best approximation
can be found by minimizing the KL-divergence between
qÃÉ(Z, b, Œ≥ | ¬µ) and the posterior distribution q(Z, Œ≥, b | ¬µ)
with respect to variational parameters. It can be shown that
we have the following mean field update equations. For the
topic assignment variational parameter œà, we have:

h
k
œàdi
‚àù exp EqÃÉ(Z‚àídi )qÃÉ(b) log(Œ±k + n‚àídi
dk¬∑ )
X
+log(Œ≤wdi + n‚àídi
Œ≤v + n‚àídi
¬∑kwdi ) ‚àí log(
¬∑k¬∑ )
v

+

X

i
¬µl bl œÜl (Z, W) ,

l

P
where ndkv ,
i 1(zdi = k, wdi = v) is the number of times that word v is assigned to topic k in document d; P
the dot denotes summation over that index (e.g.,
ndk¬∑ = v ndkv ); and ‚àídi denotes that word wdi is excluded in calculating the counts. Note that the last term incorporates the FOL logic constraints. Exact computation of
the expectations is still very expensive, however. We thus
make further approximations. The first three terms in the
exponential are the same as in the collapsed variational inference (CVI) algorithm for LDA and we can approximate
it effectively by zero-order information (Asuncion et al.,
2009). For the last term, we approximate it by using the
mode ZÃÇ of the current distribution qÃÉ(Z). We get:
‚àídi
P
Œ±k + N¬∑dk
‚àídi
k
l ¬µl Œªl œÜl (ZÃÇ,W) ,
(Œ≤
+
N
)e
œàdi
‚àùP
w
di
¬∑kwdi
‚àídi
Œ≤
+
N
v
v
¬∑k¬∑
(4)
P
‚àídi
k
where Ndkv , j6=i 1(wdj = v)œàdj
. For the variational
parameters œÅ and Œª, letting S(x) , 1/(1+e‚àíx ) denote the
sigmoid function, we have the mean-field update equations
(The dual variables ¬µ are given):

P

2
m ((Œ≥ÃÉlm )
2œÉl2

+ œÉl2 )


+¬µl (EqÃÉ(Z) [œÜl (Z, W)] ‚àí œÅl ) ,
P
‚àí¬µl Œªl œÉl2 + Œªl ( m Œ≥ÃÉlm )
œÅl =
.
M Œªl
Due to space limit, we briefly explain the intuition behind
Œªl update. It is influenced by both the coherence of belief labels (the first and second terms) and the difference
between the current expected feature value and the golden
standard for the rule (the third term). Therefore, Robust
RegBayes infers the reliability of each rule by considering
both noisy labels and the underline Bayesian latent variable
model.
Weight Learning: To learn the dual parameters ¬µ (i.e.,
the weights of FOL rules), we perform stochastic gradient
descent (SGD) to the dual problem (3). Since the exact
calculation of the gradient is intractable, we approximate it
as follows:
X
‚àÇ¬µl log Z(¬µ) =
q(Z, Œ≥, b | ¬µ)bl (œÜl (Z, W) ‚àí Œ≥l )
Z,Œ≥,b

‚âà

X

qÃÉ(Z, Œ≥, b | ¬µ)bl (œÜl (Z, W) ‚àí Œ≥l )

Z,Œ≥,b

‚âà EqÃÉ(bl ) [bl ] (œÜÃÇl (ZÃÇ, W) ‚àí EqÃÉ(Œ≥l ) [Œ≥l ]), (5)
where the first equality holds due to duality; the first approximation is due to variational approximation; the second approximation is due to approximating the expectation
of the logic rule. Here, we use the mode ZÃÇ of the variational distribution qÃÉ(Z, Œ≥, b | ¬µ) which is efficient since
Z is independent under the mean field assumption. Another approximation is made to calculate œÜl (Z, W) when
the number of groundings is too large ‚Äî we approximate
it by uniformly sampling the groundings for such rules, denoted as œÜÃÇl (Z, W). These approximations work well in
practice, as we show below.
With the approximate gradients, we update the weights by
the SGD rule:
¬µt+1
= P roj[‚àíC,C] (¬µtl + œÑt (‚àí‚àÇ¬µl log Z(¬µ) + )), (6)
l
where P roj[s,t] (x) denotes the Euclidean projection of x
to the interval [s, t]; and œÑt is the step length which satisfies
mild conditions to ensure convergence (Bottou & Bousquet, 2011). In our implementation we set œÑt = (t + œÑ0 )‚àíŒ∫
and tune parameters œÑ0 and Œ∫.

4. Experiments
We now present empirical results on learning both unsupervised and supervised topic models to demonstrate the efficacy of Robust RegBayes on incorporating noisy FOL do-

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models
Table 1. Datasets. Intuitively, seed rule anchors a specific word to a specific topic, which will attract similar words to the topic; cannotlink rule forces two specific words into different topics; doc seed rule is similar to seed rule, but only applies to specific documents.
See (Andrzejewski et al., 2011) for the formal definitions of seed, cannot-link, docseed, inclusion, and exclusion rules.

Dataset
COMP
COM
POL
HDG

#Documents
5,000
2,740
2,000
24,073

#Topics
20
25
20
50

Description

#FOL Rules

comp.* in 20 newsgroup data
U.S. House of Representatives
movie reviews
PubMed abstracts

8 seeds
3 seeds, 2 docseeds
1 cannot-link
8 seeds, 6 inclusion, 6 exclusion

main knowledge. In short, Robust RegBayes shows superior ability to discover latent semantic structures and make
accurate predictions in the supervised settings.
4.1. Experiments with Unsupervised Topic Models
We denote our Robust RegBayes applied to LDA as
‚ÄúRLogicLDA.‚Äù A special case of RLogicLDA is to set
bl = 1 for all rules in Eq. (2), i.e., do not allow the model to
ignore any rules via the slab component. Equivalently, the
special case treats all rules as valid. We denote the special
case as ‚ÄúLogicLDA.‚Äù For baselines, we use (i) the vanilla
LDA using Gibbs sampling, and (ii) Fold¬∑all, a MAP estimator to incorporate FOL into LDA. Fold¬∑all requires experts to manually set the weights of rules. We adopt the
well-performing ‚ÄúMir‚Äù method for Fold¬∑all and download
the authors‚Äô implementation (Andrzejewski et al., 2011).
4.1.1. L OGIC LDA VS . LDA AND F OLD¬∑ALL
We first show that LogicLDA achieves similar performance
as Fold¬∑all (which has the benefit of expert-set rule weights)
by automatically learning rule weights. We use all four real
datasets in (Andrzejewski et al., 2011) and the same logic
rules. The logic rules contain ‚Äúseed rules‚Äù which assign
specific words to specific topics, ‚Äúcannot-link rules‚Äù which
force two words into separate topics, and so on. Details
are in Table 1. Since no belief labels Œ≥ÃÉl were provided with
their data, we define them by examining the meaning of the
logic rules: All the rules in COMP, CON and POL aim to
make the learned topics more understandable for humans,
we set all the belief labels of these rules at Œ≥ÃÉl = 1. For
HDG, the rules are given by biological experts and should
be satisfied according to the description. Thus, we also set
their belief labels at 1. As in (Andrzejewski et al., 2011),
we randomly split documents into training/testing sets by a
ratio of 8/2. For LogicLDA, we utilize the FOL rules during training and estimate the topics œï from the posterior
distribution qÃÉ(Z) as in (Asuncion et al., 2009). As in (Andrzejewski et al., 2011), the knowledge is assumed to be
encoded into the estimated topics. Therefore, for testing,
we do not utilize the logic rules and only optimize the variational bound given œï as in vanilla LDA (Blei et al., 2003).
We measure test set perplexity to evaluate LDA perfor-

mance (Blei et al., 2003). To show different methods‚Äô
ability in incorporating logic rules, we also measure the
proportion of satisfied logic rules. For fairness, all parameters are the same as in (Andrzejewski et al., 2011)
across all the methods in comparison, e.g. we use the same
symmetric Dirichlet parameters Œ± = 1, Œ≤ = 1 below.
For the extra parameters in our methods, we simply set
 = 0.001 and the regularization parameter C at a large
number (e.g., 1000000) so that the dual parameters ¬µ never
reach the bounds in Eq (3). The SGD step length decays as
œÑt = (t + 10)‚àí0.5 by cross validation on the training data.
We run each method five times under random initialization
and report the average results in Table 2. LogicLDA is superior to LDA and Fold¬∑all by both measures: First, LogicLDA achieves the lowest test set perplexity in three out
of four data sets. These differences are statistically significant under 2-tailed paired t-test with significance level
p < 0.02. In addition, on the CON data set LogicLDA is
not significantly different than the best (LDA).
Second, LogicLDA and Fold¬∑all both achieve much higher
proportion of FOL rule satisfaction than LDA (except for
the POL data set, where all models achieve near 100% satisfaction). Importantly, LogicLDA does so by automatically learning the rule weights, while Fold¬∑all has to rely
on human experts to specify the weights.
4.1.2. RL OGIC LDA VS . L OGIC LDA: ROBUSTNESS
We examine the robustness of RLogicLDA by comparing
it with LogicLDA under the same settings as above, but
with potentially unreliable domain knowledge. To this end,
we intentionally design one potentially unreliable FOL rule
for each of the four datasets, see Table 3. We show each
designed rule to M = 20 volunteers and collected their
subjective belief label Œ≥ÃÉ lm on that rule. Specifically, each
volunteer can select their Œ≥ÃÉ lm between 0 and 1 with step
size 0.1 via a user interface. Table 3 shows the histogram
of Œ≥ÃÉ lm : a flat histogram indicates disagreements among the
volunteers and thus unreliable rule.
RLogicLDA performs better than LogicLDA in test set perplexity, as shown in Table 3. On COMP and HDG data
sets, the difference is statistically significant under 2-tailed
paired t-test (p < 0.02) while on CON and POL the dif-

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models
Table 2. Test set perplexity and proportion of satisfied logic rules on four datasets.

COMP
CON
POL
HDG

Proportion of Satisfied Logic Rules
LDA
Fold¬∑all
LogicLDA
0.00 ¬± 0.00 1.00 ¬± 0.00 0.97 ¬± 0.01
0.07 ¬± 0.04 0.67 ¬± 0.03 0.70 ¬± 0.00
1.00 ¬± 0.00 1.00 ¬± 0.00 1.00 ¬± 0.00
0.60 ¬± 0.01 0.95 ¬± 0.00 0.96 ¬± 0.01

Table 3. RLogicLDA is robust to unreliable domain knowledge
Test Set Perplexity
Satisfaction Proportion
Designed Rule
Histogram
LogicLDA
RLogicLDA
LogicLDA
RLogicLDA
seed: {problem,
windows, window,
available, files, mac,
1467 ¬± 6
1446 ¬± 6 0.39 ¬± 0.16 0.07 ¬± 0.06
apple, system, im} ‚Üí
topic 1
4
3
2
0

1

COMP

Frequency

5

6

Data

Test Set Perplexity
LDA
Fold¬∑all
LogicLDA
1531 ¬± 12 1537 ¬± 11 1463 ¬± 5
1206 ¬± 6
1535 ¬± 10 1216 ¬± 11
3218 ¬± 13 3220 ¬± 13 3176 ¬± 12
940 ¬± 6
973 ¬± 7
885 ¬± 2

0.0

0.2

0.4

0.6

0.8

1.0

0.8

1.0

0.8

1.0

0.8

1.0

4
3
2

Frequency

1228 ¬± 16

0.49 ¬± 0.03

0.08 ¬± 0.03

3173 ¬± 13

3168 ¬± 11

0.57 ¬± 0.19

0.09 ¬± 0.04

895 ¬± 2

891 ¬± 2

0.75 ¬± 0.03

0.95 ¬± 0.01

1

1228 ¬± 9

0
0.0

0.2

0.4

0.6

Belief

4
3
2
1

must-link{acting,
make, performance,
character}: same topic

0

POL

Frequency

5

6

CON

seed: {bill, people, law,
health, tax, trade,
economy, budget,
pension} ‚Üí topic 7

5

6

Belief

0.0

0.2

0.4

0.6

4
3
2
1

cannot-link{human,
gene}: different topics

0

HDG

Frequency

5

6

Belief

0.0

0.2

0.4

0.6

Belief

ference is not significant. It achieves this by only listening to reliable rules. The empirical means of the belief labels for the four rules are 0.50, 0.40, 0.52 and 0.72 respectively. The satisfaction proportions of LogicLDA are close
to these empirical means ‚Äì it indiscriminately obeys all domain knowledge. In contrast, RLogicLDA is able to ignore
the first three rules it deems unreliable, while obeying the
fourth rule. This is reflected in RLogicLDA‚Äôs proportions.
4.2. Experiments with Supervised Topic Models
We now show that robustly incorporating knowledge can
help achieve both higher prediction performance and better
interpretability of learned topics compared to other supervised LDA methods.
4.2.1. S ETTINGS AND D OMAIN K NOWLEDGE
We use the HotelReview dataset (Zhu & Xing, 2010) and
predict the global rating (an integer from 1 to 5) of each hotel review based on its content. As in (Zhu & Xing, 2010),
we treat it as a regression problem and normalize the ratings. The dataset contains 5,000 reviews and is equally
split into training and testing sets. Besides the global rating, each review also has the ratings of five aspects: value,
location, service, room, and cleanliness. Discovering the

latent correspondence between review contents and aspects
is an interesting research topic (Wang et al., 2010). Here,
we use seed rules to assign several representative words of
each aspect to a specific set of topics. Specifically, we assign words {value, price, quality, worth, resort} to topics
1 and 2 to seed the value aspect; {location, traffic, restaurant, beach} to topic 3 to seed the location aspect; {service,
food, breakfast, dinner} to topics 4‚Äì6 to seed the service aspect; and {door, floor, bed, stay, bathroom, room} to topics
7‚Äì10 to seed the room aspect. We ignore the cleanliness
aspect because we find reviews on cleanliness usually are
contained within the reviews on the room aspect and thus
redundant. Furthermore, to distinguish positive and negative aspects, we use a ‚Äúsentiment seed rule‚Äù to assign 19
seed positive words to topics 1,3,5,7,9.1
Note that these rules represent our intention to relate topics
and aspects. Therefore, we set all belief labels for the five
rules to 1.0. Finally, as in Section 4.1.2, we also collect
empirical belief labels from M = 20 volunteers for one
reliable rule (the ‚ÄúNot rule‚Äù) and one unreliable rule (the
‚ÄúBut rule‚Äù), see Table 4.
1
The 19 seed words are amazing, beach, beautiful, comfortable, enjoyed, excellent, fantastic, fresh, friendly, good, great,
large, lovely, nice, perfect, wonderful, best, recommend and enjoy.

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models
Table 4. Intentionally Designed Reliable and Unreliable Rules

Description

Histogram

Satisfaction Proportion
sLogicLDA
sRLogicLDA

mean(Œ≥ÃÉ lm )

p(bl = 1 | Œªl )

0.91

0.99

0.98 ¬± 0.03

1.00 ¬± 0.00

0.56

0.00

0.70 ¬± 0.13

0.05 ¬± 0.4

4
3
2

Frequency

1
0

0.2

0.4

0.6

0.8

1.0

0.8

1.0

4
3
2

Frequency

5

6

Belief

1

But rule

0.0

0

Not rule

seed: {adjectives with
negation within
distance 4 before it} ‚Üí
the last topic
seed: {all words before
adversative transition
(e.g. ‚Äúbut‚Äù) in
sentences} ‚Üí the last
topic

5

6

Rule

0.0

0.2

0.4

0.6

Belief

4.2.2. P REDICTION P ERFORMANCE
We build our supervised RLogicLDA (‚ÄúsRLogicLDA‚Äù)
by adding the same max-margin posterior constraints as
in (Zhu et al., 2013a) to RLogicLDA. The parameter settings of , C and Œ± are the same as in the unsupervised experiments. The other parameters (Œ±, Œ≤) and the regularization parameter introduced by max-margin constraints (Zhu
et al., 2013a) are set by cross-validation on the training
set. For baselines, we compare with (i) maximum entropy
discrimination LDA regression (MedLDAr) (Zhu et al.,
2013a), a RegBayes model that incorporates max-margin
posterior regularization into LDA; (ii) supervised conditional topical random fields (sCTRF) (Zhu & Xing, 2010),
a feature based model that incorporates both single and
pairwise word features into MedLDAr.
We run each algorithm five times with random initialization
and random split, and report the average test set results in
Figure 2(a). Note with our setting sRLogicLDA requires at
least 10 topics to accommodate for the FOL rules, thus its
curve starts at #topics=10; while the baselines have no logic
rules and they start at #topic=3. We use predictive R2 (Zhu
& Xing, 2010) as the performance measure of regression.
sRLogicLDA achieves comparable performance as feature
based sCTRF, and outperforms MedLDAr. Note that sCTRF uses 15 features on words,2 while sRLogicLDA only
needs 7 simple logic rules. Therefore, incorporating domain knowledge as constraints is useful for prediction compared with feature engineering approaches.
4.2.3. T OPIC I NTERPRETABILITY
Tables 5,6 show the top 10 words of each topic learned by
sRLogicLDA and sCTRF with K = 15 topics.3 We manu-

ally judged which words represent the value, location, service and room aspects, respectively, and colored them orange, blue, cyan and red, respectively. When applicable,
we mark FOL seed words with an ‚àó.
sRLogicLDA has a clear correspondence between topics
and aspects due to the FOL rules. Topics T1‚ÄìT10 obey the
grouping into the four aspects (denoted by vertical lines in
Table 5). The only exception is T7, which we suspect is
because the other three topics T8‚ÄìT10 are sufficient in describing the room aspect. We also note that sRLogicLDA is
successful in attracting non FOL seeded, but aspect-related,
words into the topics (i.e., those colored words not marked
by an ‚àó in Table 5). In contrast, such a clear correspondence
is largely absent in sCTRF (Table 6). Its topics contain a
mix of room, location, service aspects, and the value aspect
is missing among the top topic words.
Finally, we study sRLogicLDA‚Äôs ability to utilize the sentiment seed rule to attract additional positive words into specific topics. The set of positive topics, denoted as Tp =
{T 1, T 3, T 5, T 7, T 9}, is defined as the topics specified by
the sentiment seed rule. The set of other topics is denoted
as To . We hope to see that Tp attracts many more positive
sentiment words (excluding the 19 seed words which the
rule forces into Tp anyway), and that To attracts fewer positive sentiment words (including the 19 seed words since
any positive words in To is undesirable). To this end, we
first obtain a commonly-used positive word list W containing 2006 positive words.4 Note W includes the 19 seed
words. We measure the amount of positive words in To
by the P
averagePweights of words in W over these topics:
œïkw
Ao = k‚ààTo |Tow‚ààW
. Let W\19 be the set W exclud|
ing the 19 seed words. P
We measure
the amount of positive
P
k‚ààTp

2

The sCTRF features are: 9 Part-of-Speech features that categorize the words, 5 WordNet sentiment features, and 1 feature on
whether two words belong to the same phrase.
3
We observed similar phenomenon with other K. We did not
include the topics learned by MedLDAr for two reasons: first, as
Figure 2(a) shows MedLDAr has inferior predictive performance
compared to sCTRF and sRLogicLDA. Second, it was shown in
(Zhu & Xing, 2010) that MedLDAr produces less interpretable

w‚ààW

œïkw

\19
words in Tp by Ap =
. Our hypothe|Tp |
sis is that, with the sentiment seed rule, Ap ‚â• Ao . Note
that because of the exclusion of seed words from the computation of Ap , this hypothesis is a very strict comparison.

topics than sCTRF on the same data.
4
http://www.cs.uic.edu/‚àºliub/FBS/opinion-lexiconEnglish.rar.

3

5

10

15

20

25

# Topics

0.58

PredictiveR2

0.62

0.06
0.05
0.04
0.03

sRLogicLDA
sLogicLDA

0.54

0.02
0.01

positive word weights

0.00

0.60
0.55
0.50

sRLogicLDA
sCTRF
MedLDAr

0.45

PredictiveR2

0.65

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models

10

Ap

(a)

15

20

25

# Topics

Ao

(b)

(c)

Figure 2. (a) Predictive R2 of sRLogicLDA, sCTRF, and MedLDAr. (b) average weights of positive words in the positive topic set (Ap )
and the other topic set (Ao ); and (c) predictive R2 of sRLogicLDA and sLogicLDA.
Table 5. Top 10 words in Sampled Topics learned by sRLogicLDA
T1+
resort
free
*price
great
*worth
island
trip
beautiful
*quality
place

T2
n‚Äôt
pay
but
money
check
time
back
car
expensive
lobby

T3+
*beach
*location
nice
street
parking
area
good
*restaurant
internet
great

T4
restaurant
fruit
*dinner
wine
served
morning
menu
evening
meal
eggs

T5+
pool
good
holiday
bar
entertainment
day
*food
euros
lovely
evening

T6
*breakfast
*food
*service
but
day
water
bar
buffet
drinks
lunch

T7+
but
n‚Äôt
kids
people
time
nice
night
great
day
family

T8
*room
told
asked
desk
front
manager
*stay
called
call
back

T9+
*room
*bed
*bathroom
shower
*door
*floor
colorred*stay
bedroom
coffee
towels

T10
hotel
*room
rooms
*stay
hotels
night
booked
*floor
city
view

T11
staff
but
good
guests
time
however
bit
reviews
bar
found

T12
pool
view
area
balcony
small
chairs
spa
lounge
pools
ocean

T13
but
reception
small
area
however
road
car
park
tv
side

T14
but
hotel
staff
people
day
time
place
n‚Äôt
back
night

T15
n‚Äôt
night
looked
smell
work
air
left
dirty
carpet
back

Table 6. Topics learned by sCTRF in a randomly selected run
T1
n‚Äôt
poor
dirty
bad
room
hotel
worst
back
small
awful

T2
room
n‚Äôt
told
asked
hotel
back
manager
stay
called
night

T3
room
n‚Äôt
told
hotel
back
front
desk
stay
asked
manager

T4
room
n‚Äôt
hotel
stay
front
desk
back
night
rooms
door

T5
room
n‚Äôt
hotel
stay
night
rooms
back
bed
front
time

T6
room
hotel
n‚Äôt
stay
night
rooms
time
staff
bed
breakfast

T7
hotel
room
n‚Äôt
night
stay
rooms
breakfast
staff
time
day

T8
hotel
room
n‚Äôt
breakfast
staff
day
night
rooms
time
area

Fig 2(b) presents the average Ap and Ao from five randomized run. Ap is indeed statistically significantly larger than
Ao (2-tailed unpaired t-test with p < 0.02). Therefore, the
sentiment seed rule attracts more positive words to Tp .
Taken together, these results demonstrate that by incorporating FOL rules on aspect-topic relation, sRLogicLDA
learns topics with improved interpretability.
4.2.4. ROBUSTNESS
We examine sRLogicLDA‚Äôs ability to automatically infer
robustness of FOL rules by comparing it with one variant:
sLogicLDA‚Äîa special case of sRLogicLDA where all bl
are set to 1 (i.e., forced to use all FOL rules with no attempt
to infer their robustness).
First, Table 4 shows that sLogicLDA simply matches satisfaction proportions to the empirical mean of belief labels,
while sRLogicLDA is more sophisticated and achieves a
quite different proportion on the unreliable ‚ÄúBut rule.‚Äù This
demonstrates that sRLogicLDA can select the reliable ‚ÄúNot
rule‚Äù and ignore the unreliable ‚ÄúBut rule.‚Äù Second, Fig-

T9
hotel
room
day
staff
area
breakfast
pool
time
n‚Äôt
night

T10
hotel
pool
day
area
staff
rooms
food
time
breakfast
good

T11
hotel
pool
day
food
good
bar
area
staff
beach
restaurant

T12
pool
hotel
food
good
beach
bar
day
nice
restaurant
staff

T13
beach
pool
food
good
resort
bar
great
day
hotel
nice

T14
beach
resort
great
pool
good
food
island
day
nice
ocean

T15
great
lovely
good
beautiful
excellent
beach
wonderful
nice
fantastic
amazing

ure 2(c) shows that sRLogicLDA outperforms sLogicLDA
in predictive R2 ,suggesting that automatically inferring the
robustness of knowledge achieves better performance.

5. Conclusions
We proposed Robust RegBayes, a framework to selectively
incorporate noisy FOL domain knowledge into Bayesian
models via posterior regularization. We applied our framework to unsupervised and supervised topic models, and
demonstrated that through incorporating domain knowledge robustly, we can improve both the predictive performance and topic interpretability. In the future, we plan
to extend Robust RegBayes to incorporate FOL domain
knowledge into Bayesian nonparametric models.

Acknowledgments
The work was supported by the National Basic Research
Program of China (Nos. 2013CB329403, 2012CB316301)
and National Natural Science Foundation of China (Nos.
61322308, 61332007) to JZ, and a Google Faculty Research Award to XZ.

Robust RegBayes: Selectively Incorporating First-Order Logic Knowledge into Bayesian Models

References
Andrzejewski, D., Zhu, X., Craven, M., and Recht, B. A
framework for incorporating general domain knowledge
into latent Dirichlet allocation using first-order logic. In
International Joint Conference on Artificial Intelligence
(IJCAI), 2011.
Asuncion, A., Welling, M., Smyth, P., and Teh, Y.W. On
smoothing and inference for topic models. In Uncertainty in Artificial Intelligence (UAI), 2009.
Blei, D.M., Ng, A.Y., and Jordan, M.I. Latent Dirichlet
allocation. Journal of Machine Learning Research, 3:
993‚Äì1022, 2003.
Bottou, L. and Bousquet, O. The tradeoffs of large-scale
learning. Optimization for Machine Learning, pp. 351,
2011.
Garthwaite, P., Kadane, J., and O‚ÄôHagan, A. Statistical
methods for eliciting probability distributions. Journal
of the American Statistical Association, 100(470):680‚Äì
700, 2005.
Mao, Y. and Lebanon, G. Domain knowledge uncertainty
and probabilistic parameter constraints. In Uncertainty
in Artificial Intelligence (UAI), 2009.
Raykar, V., Yu, S., Zhao, L., Valadez, G.H., Florin, C., Bogoni, L., and Moy, L. Learning from crowds. Journal of
Machine Learning Research, 11:1297‚Äì1322, 2010.
Richardson, M. and Domingos, P. Markov logic networks.
Machine Learning, 62(1-2):107‚Äì136, 2006.
Teh, Y.W., Newman, D., and Welling, M. A collapsed variational Bayesian inference algorithm for latent Dirichlet
allocation. Advances in Neural Information Processing
Systems (NIPS), 19:1353, 2007.
Wainwright, M.J. and Jordan, M.I. Graphical models, exponential families, and variational inference. Foundations and Trends in Machine Learning, 1(1-2):1‚Äì305,
2008.
Wang, H., Lu, Y., and Zhai, C. Latent aspect rating analysis
on review text data: a rating regression approach. In
International Conference on Knowledge Discovery and
Data mining (SIGKDD), 2010.
Welinder, P., Branson, S., Belongie, S., and Perona, P. The
multidimensional wisdom of crowds. In Advances in
Neural Information Processing Systems (NIPS), 2010.
Zhu, J. Max-margin nonparametric latent feature models
for link prediction. In International Conference on Machine Learning (ICML), 2012.

Zhu, J. and Xing, E.P. Conditional topic random fields. In
International Conference on Machine Learning (ICML),
2010.
Zhu, J., Chen, N., and Xing, E.P. Infinite latent SVM for
classification and multi-task learning. Advances in Neural Information Processing Systems (NIPS), 25, 2011.
Zhu, J., Chen, N., Perkins, H., and Zhang, B. Gibbs maxmargin topic models with fast sampling algorithms. In
International Conference on Machine Learning (ICML),
2013a.
Zhu, J., Chen, N., and Xing, E.P. Bayesian inference with
posterior regularization and applications to infinite latent
SVMs. arXiv:1210.1766v2, 2013b.

